let restaurant;
var newMap;
/**
 * Initialize map as soon as the page is loaded.
 */

document.addEventListener('DOMContentLoaded', event => {
  initMap();
  registerServiceWorker();
});
/**
 * Initialize worker
 */

const worker = new Worker('js/worker.js');
worker.addEventListener('message', e => {
  switch (e.data.cmd) {
    case 'fetch_reviews':
      if (e.data.error) {
        console.log(e.data.error);
        return;
      }

      generateReviewsHTML(e.data.reviews);
      break;

    case 'fetch_restaurant':
      if (e.data.error) {
        console.log(e.data.error);
        return;
      }

      self.restaurant = e.data.restaurant;
      fillRestaurantHTML();
      handleRestaurant(null, self.restaurant);
      break;
  }
});
/**
 * Initialize leaflet map
 */

initMap = () => {
  fetchRestaurantFromURL();
};
/**
 * Get current restaurant from page URL.
 */


fetchRestaurantFromURL = () => {
  if (self.restaurant) {
    // restaurant already fetched!
    handleRestaurant(null, self.restaurant);
    return;
  }

  const id = getParameterByName('id');

  if (!id) {
    // no id found in URL
    error = 'No restaurant id in URL';
    handleRestaurant(error, null);
  } else {
    worker.postMessage({
      cmd: 'fetch_restaurant',
      id: id
    });
  }
};
/**
 * Handle restaurant callback
 */


handleRestaurant = (error, restaurant) => {
  if (error) {
    // Got an error!
    console.error(error);
  } else {
    self.newMap = L.map('map', {
      center: [restaurant.latlng.lat, restaurant.latlng.lng],
      zoom: 16,
      scrollWheelZoom: false
    });
    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}', {
      mapboxToken: 'pk.eyJ1IjoibGVtYSIsImEiOiJjamt0YXVla2MwM3NjM3dvZHQ0NDIwZmVpIn0.pOEFaPY6enCchIG29Lo2SQ',
      maxZoom: 18,
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' + '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' + 'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
      id: 'mapbox.streets'
    }).addTo(newMap);
    fillBreadcrumb();
    DBHelper.mapMarkerForRestaurant(self.restaurant, self.newMap);
  }
};
/**
 * Create restaurant HTML and add it to the webpage
 */


fillRestaurantHTML = (restaurant = self.restaurant) => {
  const name = document.getElementById('restaurant-name');
  name.innerHTML = restaurant.name;
  const address = document.getElementById('restaurant-address');
  address.innerHTML = restaurant.address;
  const picture = document.getElementById('restaurant-picture');
  picture.className = 'restaurant-picture';
  const favButton = document.getElementById('favbutton');

  if (restaurant.is_favorite === 'false') {
    favbutton.className = "heart-inactive";
  } else {
    favbutton.className = 'heart-active';
  }

  const src1 = document.getElementById('source-1');
  src1.media = "(min-width: 750px)";
  src1.srcset = `${DBHelper.imageUrlBasePath}${DBHelper.imageNameForRestaurant(restaurant)}-800_large_1x.jpg 1x`;
  src1.srcset += `,${DBHelper.imageUrlBasePath}${DBHelper.imageNameForRestaurant(restaurant)}-1200_large_2x.jpg 2x`;
  const src2 = document.getElementById('source-2');
  src2.media = "(min-width: 500px)";
  src2.srcset = `${DBHelper.imageUrlBasePath}${DBHelper.imageNameForRestaurant(restaurant)}-medium.jpg`;
  const image = document.getElementById('restaurant-img');
  image.className = 'restaurant-img';
  image.src = DBHelper.imageUrlForRestaurant(restaurant);
  image.alt = "Image of the restaurant " + restaurant.name;
  const cuisine = document.getElementById('restaurant-cuisine');
  cuisine.innerHTML = restaurant.cuisine_type; // fill operating hours

  if (restaurant.operating_hours) {
    fillRestaurantHoursHTML();
  } // fill reviews


  fillReviewsHTML();
};
/**
 * Create restaurant operating hours HTML table and add it to the webpage.
 */


fillRestaurantHoursHTML = (operatingHours = self.restaurant.operating_hours) => {
  const hours = document.getElementById('restaurant-hours');

  for (let key in operatingHours) {
    const row = document.createElement('tr');
    const day = document.createElement('td');
    day.innerHTML = key;
    row.appendChild(day);
    const time = document.createElement('td');
    time.innerHTML = operatingHours[key];
    row.appendChild(time);
    hours.appendChild(row);
  }
};
/**
 * Create all reviews HTML and add them to the webpage.
 */


fillReviewsHTML = (reviews = self.restaurant.reviews) => {
  if (!reviews) {
    worker.postMessage({
      cmd: 'fetch_reviews',
      id: self.restaurant.id
    });
  } else {
    generateReviewsHTML(reviews);
  }
};
/**
 * Generate reviews HTML
 */


generateReviewsHTML = reviews => {
  const container = document.getElementById('reviews-container');
  const reviewsMsg = document.getElementById('reviews-message');

  if (!reviews) {
    reviewsMsg.innerHTML = 'No reviews yet!';
    return;
  }

  const ul = document.getElementById('reviews-list');
  ul.innerHTML = '';
  reviewsMsg.innerHTML = '';
  reviews.forEach(review => {
    ul.appendChild(createReviewHTML(review));
  });
};
/**
 * Create review HTML and add it to the webpage.
 */


createReviewHTML = review => {
  const li = document.createElement('li');
  const div = document.createElement('div');
  div.className = "review-header";
  li.appendChild(div);
  const name = document.createElement('h3');
  name.innerHTML = review.name;
  div.appendChild(name);
  const date = document.createElement('span');
  date.innerHTML = review.date;
  date.className = "review-date";
  div.appendChild(date);
  const body = document.createElement('div');
  body.className = "review-body";
  li.appendChild(body);
  const rating = document.createElement('span');
  rating.innerHTML = `Rating: ${review.rating}`;
  rating.className = "review-rating";
  body.appendChild(rating);
  const comments = document.createElement('p');
  comments.innerHTML = review.comments;
  body.appendChild(comments);
  return li;
};
/**
 * Add restaurant name to the breadcrumb navigation menu
 */


fillBreadcrumb = (restaurant = self.restaurant) => {
  const breadcrumb = document.getElementById('breadcrumb');
  const li = document.createElement('li');
  li.innerHTML = restaurant.name;
  breadcrumb.appendChild(li);
};
/**
 * Get a parameter by name from page URL.
 */


getParameterByName = (name, url) => {
  if (!url) url = window.location.href;
  name = name.replace(/[\[\]]/g, '\\$&');
  const regex = new RegExp(`[?&]${name}(=([^&#]*)|&|#|$)`),
        results = regex.exec(url);
  if (!results) return null;
  if (!results[2]) return '';
  return decodeURIComponent(results[2].replace(/\+/g, ' '));
};
/**
 * Expand add review  
 */


const addReviewButton = document.getElementById('add-review');
addReviewButton.addEventListener('click', e => {
  e.preventDefault();
  const form = document.getElementById('submit-review');
  form.style.display = 'block';
  addReviewButton.setAttribute('aria-expanded', true);
});
/**
 * Post review
 */

const postReviewButton = document.getElementById('post-review');
postReviewButton.addEventListener('click', e => {
  e.preventDefault();
  const name = document.getElementById('name');
  const comments = document.getElementById('comments');
  const rating = document.getElementById('rating'); // Validate review fields

  if (name.value === '' || comments.value === '' || rating.value === '') return;
  const review = {};
  review.name = name.value;
  review.rating = rating.value;
  review.comments = comments.value;
  review.date = moment().format('MMMM D, YYYY');
  review.synced = false; // Reset values

  name.value = '';
  comments.value = '';
  rating.value = -1; // Fetch restaurant from DB

  DBHelper.fetchRestaurantById(self.restaurant.id, (error, restaurant) => {
    if (restaurant) {
      self.restaurant = restaurant;

      if (Array.isArray(self.restaurant.reviews)) {
        self.restaurant.reviews.push(review);
      } else {
        self.restaurant.reviews = [];
        self.restaurant.reviews.push(review);
      }

      DBHelper.updateRestaurantReviews(self.restaurant).then(result => {
        if (result) {
          const form = document.getElementById('submit-review');
          form.style.display = 'none';
          addReviewButton.setAttribute('aria-expanded', false);
          const toast = Toast.create({
            text: "Review submitted."
          });
          Toast.setTimeout(toast.id, 2000);
          fillReviewsHTML();
        }
      });
    }
  });
});
/**
 * Handle favorite button
 */

const favButton = document.getElementById('favbutton');
favbutton.addEventListener('click', e => {
  e.preventDefault();

  if (favbutton.classList.contains('heart-active')) {
    self.restaurant.is_favorite = false;
    favbutton.className = 'heart-inactive';
    DBHelper.favoriteRestaurant(self.restaurant);
  } else {
    self.restaurant.is_favorite = true;
    favbutton.className = 'heart-active';
    DBHelper.favoriteRestaurant(self.restaurant);
  }
});
/**
 * Offline event handler
 */

window.addEventListener('offline', () => {
  const toast = Toast.create({
    text: "Unable to connect. Retrying..."
  });
  Toast.setTimeout(toast.id, 5000);
});
/**
 * Online event handler
 */

window.addEventListener('online', () => {
  worker.postMessage({
    cmd: 'sync_reviews'
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwibmV3TWFwIiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJpbml0TWFwIiwicmVnaXN0ZXJTZXJ2aWNlV29ya2VyIiwid29ya2VyIiwiV29ya2VyIiwiZSIsImRhdGEiLCJjbWQiLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciLCJnZW5lcmF0ZVJldmlld3NIVE1MIiwicmV2aWV3cyIsInNlbGYiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJoYW5kbGVSZXN0YXVyYW50IiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsImlkIiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwicG9zdE1lc3NhZ2UiLCJMIiwibWFwIiwiY2VudGVyIiwibGF0bG5nIiwibGF0IiwibG5nIiwiem9vbSIsInNjcm9sbFdoZWVsWm9vbSIsInRpbGVMYXllciIsIm1hcGJveFRva2VuIiwibWF4Wm9vbSIsImF0dHJpYnV0aW9uIiwiYWRkVG8iLCJmaWxsQnJlYWRjcnVtYiIsIkRCSGVscGVyIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsIm5hbWUiLCJnZXRFbGVtZW50QnlJZCIsImlubmVySFRNTCIsImFkZHJlc3MiLCJwaWN0dXJlIiwiY2xhc3NOYW1lIiwiZmF2QnV0dG9uIiwiaXNfZmF2b3JpdGUiLCJmYXZidXR0b24iLCJzcmMxIiwibWVkaWEiLCJzcmNzZXQiLCJpbWFnZVVybEJhc2VQYXRoIiwiaW1hZ2VOYW1lRm9yUmVzdGF1cmFudCIsInNyYzIiLCJpbWFnZSIsInNyYyIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsImFsdCIsImN1aXNpbmUiLCJjdWlzaW5lX3R5cGUiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsImZpbGxSZXZpZXdzSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJrZXkiLCJyb3ciLCJjcmVhdGVFbGVtZW50IiwiZGF5IiwiYXBwZW5kQ2hpbGQiLCJ0aW1lIiwiY29udGFpbmVyIiwicmV2aWV3c01zZyIsInVsIiwiZm9yRWFjaCIsInJldmlldyIsImNyZWF0ZVJldmlld0hUTUwiLCJsaSIsImRpdiIsImRhdGUiLCJib2R5IiwicmF0aW5nIiwiY29tbWVudHMiLCJicmVhZGNydW1iIiwidXJsIiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsInJlZ2V4IiwiUmVnRXhwIiwicmVzdWx0cyIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiLCJhZGRSZXZpZXdCdXR0b24iLCJwcmV2ZW50RGVmYXVsdCIsImZvcm0iLCJzdHlsZSIsImRpc3BsYXkiLCJzZXRBdHRyaWJ1dGUiLCJwb3N0UmV2aWV3QnV0dG9uIiwidmFsdWUiLCJtb21lbnQiLCJmb3JtYXQiLCJzeW5jZWQiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiQXJyYXkiLCJpc0FycmF5IiwicHVzaCIsInVwZGF0ZVJlc3RhdXJhbnRSZXZpZXdzIiwidGhlbiIsInJlc3VsdCIsInRvYXN0IiwiVG9hc3QiLCJjcmVhdGUiLCJ0ZXh0Iiwic2V0VGltZW91dCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiZmF2b3JpdGVSZXN0YXVyYW50Il0sIm1hcHBpbmdzIjoiQUFBQSxJQUFJQSxVQUFKO0FBQ0EsSUFBSUMsTUFBSjtBQUVBOzs7O0FBR0FDLFFBQVEsQ0FBQ0MsZ0JBQVQsQ0FBMEIsa0JBQTFCLEVBQStDQyxLQUFELElBQVc7QUFDdkRDLEVBQUFBLE9BQU87QUFDUEMsRUFBQUEscUJBQXFCO0FBQ3RCLENBSEQ7QUFLQTs7OztBQUdBLE1BQU1DLE1BQU0sR0FBRyxJQUFJQyxNQUFKLENBQVcsY0FBWCxDQUFmO0FBQ0FELE1BQU0sQ0FBQ0osZ0JBQVAsQ0FBd0IsU0FBeEIsRUFBbUNNLENBQUMsSUFBSTtBQUN0QyxVQUFPQSxDQUFDLENBQUNDLElBQUYsQ0FBT0MsR0FBZDtBQUNFLFNBQUssZUFBTDtBQUNFLFVBQUlGLENBQUMsQ0FBQ0MsSUFBRixDQUFPRSxL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QSxTQUFTLENBQUNILFNBQVYsR0FBc0IsZ0JBQXRCO0FBQ0FQLElBQUFBLFFBQVEsQ0FBQ2tGLGtCQUFULENBQTRCdkcsSUFBSSxDQUFDakIsVUFBakM7QUFDRCxHQUpELE1BS0s7QUFDSGlCLElBQUFBLElBQUksQ0FBQ2pCLFVBQUwsQ0FBZ0IrQyxXQUFoQixHQUE4QixJQUE5QjtBQUNBQyxJQUFBQSxTQUFTLENBQUNILFNBQVYsR0FBc0IsY0FBdEI7QUFDQVAsSUFBQUEsUUFBUSxDQUFDa0Ysa0JBQVQsQ0FBNEJ2RyxJQUFJLENBQUNqQixVQUFqQztBQUNEO0FBQ0YsQ0FaRDtBQWNBOzs7O0FBR0FzRixNQUFNLENBQUNuRixnQkFBUCxDQUF3QixTQUF4QixFQUFtQyxNQUFNO0FBQ3ZDLFFBQU04RyxLQUFLLEdBQUdDLEtBQUssQ0FBQ0MsTUFBTixDQUFhO0FBQ3pCQyxJQUFBQSxJQUFJLEVBQUU7QUFEbUIsR0FBYixDQUFkO0FBSUFGLEVBQUFBLEtBQUssQ0FBQ0csVUFBTixDQUFpQkosS0FBSyxDQUFDNUYsRUFBdkIsRUFBMkIsSUFBM0I7QUFDRCxDQU5EO0FBUUE7Ozs7QUFHQWlFLE1BQU0sQ0FBQ25GLGdCQUFQLENBQXdCLFFBQXhCLEVBQWtDLE1BQU07QUFDdENJLEVBQUFBLE1BQU0sQ0FBQ2dCLFdBQVAsQ0FBbUI7QUFDakJaLElBQUFBLEdBQUcsRUFBRTtBQURZLEdBQW5CO0FBR0QsQ0FKRCIsInNvdXJjZXNDb250ZW50IjpbImxldCByZXN0YXVyYW50O1xudmFyIG5ld01hcDtcblxuLyoqXG4gKiBJbml0aWFsaXplIG1hcCBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4geyAgXG4gIGluaXRNYXAoKTtcbiAgcmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCk7XG59KTtcblxuLyoqXG4gKiBJbml0aWFsaXplIHdvcmtlclxuICovXG5jb25zdCB3b3JrZXIgPSBuZXcgV29ya2VyKCdqcy93b3JrZXIuanMnKTtcbndvcmtlci5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZSA9PiB7XG4gIHN3aXRjaChlLmRhdGEuY21kKSB7XG4gICAgY2FzZSAnZmV0Y2hfcmV2aWV3cyc6XG4gICAgICBpZiAoZS5kYXRhLmVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGUuZGF0YS5lcnJvcik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgZ2VuZXJhdGVSZXZpZXdzSFRNTChlLmRhdGEucmV2aWV3cyk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdmZXRjaF9yZXN0YXVyYW50JzpcbiAgICAgIGlmIChlLmRhdGEuZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5sb2coZS5kYXRhLmVycm9yKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSBlLmRhdGEucmVzdGF1cmFudDtcbiAgICAgIGZpbGxSZXN0YXVyYW50SFRNTCgpO1xuICAgICAgaGFuZGxlUmVzdGF1cmFudChudWxsLCBzZWxmLnJlc3RhdXJhbnQpO1xuICAgICAgYnJlYWs7XG4gIH1cbn0pO1xuXG4vKipcbiAqIEluaXRpYWxpemUgbGVhZmxldCBtYXBcbiAqL1xuaW5pdE1hcCA9ICgpID0+IHtcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgpO1xufSAgXG4gXG4vKipcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cbiAqL1xuZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9ICgpID0+IHtcbiAgaWYgKHNlbGYucmVzdGF1cmFudCkgeyAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcbiAgICBoYW5kbGVSZXN0YXVyYW50KG51bGwsIHNlbGYucmVzdGF1cmFudClcbiAgICByZXR1cm47XG4gIH1cbiAgXG4gIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xuICBpZiAoIWlkKSB7IC8vIG5vIGlkIGZvdW5kIGluIFVSTFxuICAgIGVycm9yID0gJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJ1xuICAgIGhhbmRsZVJlc3RhdXJhbnQoZXJyb3IsIG51bGwpO1xuICB9IFxuICBlbHNlIHtcbiAgICB3b3JrZXIucG9zdE1lc3NhZ2Uoe1xuICAgICAgY21kOiAnZmV0Y2hfcmVzdGF1cmFudCcsXG4gICAgICBpZDogaWRcbiAgICB9KTtcbiAgfVxufVxuXG4vKipcbiAqIEhhbmRsZSByZXN0YXVyYW50IGNhbGxiYWNrXG4gKi9cbmhhbmRsZVJlc3RhdXJhbnQgPSAoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcbiAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgfSBcbiAgZWxzZSB7ICAgICAgXG4gICAgc2VsZi5uZXdNYXAgPSBMLm1hcCgnbWFwJywge1xuICAgICAgY2VudGVyOiBbcmVzdGF1cmFudC5sYXRsbmcubGF0LCByZXN0YXVyYW50LmxhdGxuZy5sbmddLFxuICAgICAgem9vbTogMTYsXG4gICAgICBzY3JvbGxXaGVlbFpvb206IGZhbHNlXG4gICAgfSk7XG4gICAgTC50aWxlTGF5ZXIoJ2h0dHBzOi8vYXBpLnRpbGVzLm1hcGJveC5jb20vdjQve2lkfS97en0ve3h9L3t5fS5qcGc3MD9hY2Nlc3NfdG9rZW49e21hcGJveFRva2VufScsIHtcbiAgICAgIG1hcGJveFRva2VuOiAncGsuZXlKMUlqb2liR1Z0WVNJc0ltRWlPaUpqYW10MFlYVmxhMk13TTNOak0zZHZaSFEwTkRJd1ptVnBJbjAucE9FRmFQWTZlbkNjaElHMjlMbzJTUScsXG4gICAgICBtYXhab29tOiAxOCxcbiAgICAgIGF0dHJpYnV0aW9uOiAnTWFwIGRhdGEgJmNvcHk7IDxhIGhyZWY9XCJodHRwczovL3d3dy5vcGVuc3RyZWV0bWFwLm9yZy9cIj5PcGVuU3RyZWV0TWFwPC9hPiBjb250cmlidXRvcnMsICcgK1xuICAgICAgICAnPGEgaHJlZj1cImh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1zYS8yLjAvXCI+Q0MtQlktU0E8L2E+LCAnICtcbiAgICAgICAgJ0ltYWdlcnkgwqkgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm1hcGJveC5jb20vXCI+TWFwYm94PC9hPicsXG4gICAgICBpZDogJ21hcGJveC5zdHJlZXRzJyAgICBcbiAgICB9KS5hZGRUbyhuZXdNYXApO1xuICAgIGZpbGxCcmVhZGNydW1iKCk7XG4gICAgREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChzZWxmLnJlc3RhdXJhbnQsIHNlbGYubmV3TWFwKTtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxuICovXG5maWxsUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcblxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcblxuICBjb25zdCBwaWN0dXJlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtcGljdHVyZScpO1xuICBwaWN0dXJlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LXBpY3R1cmUnO1xuXG4gIGNvbnN0IGZhdkJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmYXZidXR0b24nKTtcbiAgaWYgKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09ICdmYWxzZScpIHtcbiAgICBmYXZidXR0b24uY2xhc3NOYW1lID0gXCJoZWFydC1pbmFjdGl2ZVwiXG4gIH1cbiAgZWxzZSB7XG4gICAgZmF2YnV0dG9uLmNsYXNzTmFtZSA9ICdoZWFydC1hY3RpdmUnO1xuICB9XG5cbiAgY29uc3Qgc3JjMSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3VyY2UtMScpO1xuICBzcmMxLm1lZGlhID0gXCIobWluLXdpZHRoOiA3NTBweClcIlxuICBzcmMxLnNyY3NldCA9IGAke0RCSGVscGVyLmltYWdlVXJsQmFzZVBhdGh9JHtEQkhlbHBlci5pbWFnZU5hbWVGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS04MDBfbGFyZ2VfMXguanBnIDF4YDtcbiAgc3JjMS5zcmNzZXQgKz0gYCwke0RCSGVscGVyLmltYWdlVXJsQmFzZVBhdGh9JHtEQkhlbHBlci5pbWFnZU5hbWVGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS0xMjAwX2xhcmdlXzJ4LmpwZyAyeGA7XG5cbiAgY29uc3Qgc3JjMiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3VyY2UtMicpO1xuICBzcmMyLm1lZGlhID0gXCIobWluLXdpZHRoOiA1MDBweClcIlxuICBzcmMyLnNyY3NldCA9IGAke0RCSGVscGVyLmltYWdlVXJsQmFzZVBhdGh9JHtEQkhlbHBlci5pbWFnZU5hbWVGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfS1tZWRpdW0uanBnYDtcblxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnXG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcbiAgaW1hZ2UuYWx0ID0gXCJJbWFnZSBvZiB0aGUgcmVzdGF1cmFudCBcIiArIHJlc3RhdXJhbnQubmFtZTtcblxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xuICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xuXG4gIC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXG4gIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XG4gIH1cbiAgLy8gZmlsbCByZXZpZXdzXG4gIGZpbGxSZXZpZXdzSFRNTCgpO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZpbGxSZXN0YXVyYW50SG91cnNIVE1MID0gKG9wZXJhdGluZ0hvdXJzID0gc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3VycykgPT4ge1xuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XG4gIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xuICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG5cbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XG4gICAgcm93LmFwcGVuZENoaWxkKGRheSk7XG5cbiAgICBjb25zdCB0aW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICB0aW1lLmlubmVySFRNTCA9IG9wZXJhdGluZ0hvdXJzW2tleV07XG4gICAgcm93LmFwcGVuZENoaWxkKHRpbWUpO1xuXG4gICAgaG91cnMuYXBwZW5kQ2hpbGQocm93KTtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cbiAqL1xuZmlsbFJldmlld3NIVE1MID0gKHJldmlld3MgPSBzZWxmLnJlc3RhdXJhbnQucmV2aWV3cykgPT4ge1xuICBpZiAoIXJldmlld3MpIHtcbiAgICB3b3JrZXIucG9zdE1lc3NhZ2Uoe1xuICAgICAgY21kOiAnZmV0Y2hfcmV2aWV3cycsXG4gICAgICBpZDogc2VsZi5yZXN0YXVyYW50LmlkXG4gICAgfSk7XG4gIH1cbiAgZWxzZSB7XG4gICAgZ2VuZXJhdGVSZXZpZXdzSFRNTChyZXZpZXdzKTtcbiAgfVxufVxuXG4vKipcbiAqIEdlbmVyYXRlIHJldmlld3MgSFRNTFxuICovXG5nZW5lcmF0ZVJldmlld3NIVE1MID0gcmV2aWV3cyA9PiB7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWNvbnRhaW5lcicpO1xuICBjb25zdCByZXZpZXdzTXNnID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbWVzc2FnZScpO1xuXG4gIGlmICghcmV2aWV3cykge1xuICAgIHJldmlld3NNc2cuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG4gIHVsLmlubmVySFRNTCA9ICcnO1xuICByZXZpZXdzTXNnLmlubmVySFRNTCA9ICcnO1xuICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcbiAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xuICB9KTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuY3JlYXRlUmV2aWV3SFRNTCA9IChyZXZpZXcpID0+IHtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgZGl2LmNsYXNzTmFtZSA9IFwicmV2aWV3LWhlYWRlclwiO1xuICBsaS5hcHBlbmRDaGlsZChkaXYpO1xuXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpO1xuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xuICBkaXYuYXBwZW5kQ2hpbGQobmFtZSk7XG5cbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgZGF0ZS5pbm5lckhUTUwgPSByZXZpZXcuZGF0ZTtcbiAgZGF0ZS5jbGFzc05hbWUgPSBcInJldmlldy1kYXRlXCI7XG4gIGRpdi5hcHBlbmRDaGlsZChkYXRlKTtcblxuICBjb25zdCBib2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGJvZHkuY2xhc3NOYW1lID0gXCJyZXZpZXctYm9keVwiO1xuICBsaS5hcHBlbmRDaGlsZChib2R5KTtcblxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcbiAgcmF0aW5nLmNsYXNzTmFtZSA9IFwicmV2aWV3LXJhdGluZ1wiXG4gIGJvZHkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcblxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuICBib2R5LmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcblxuICByZXR1cm4gbGk7XG59XG5cbi8qKlxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcbiAqL1xuZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudD1zZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgbGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcbn1cblxuLyoqXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxuICovXG5nZXRQYXJhbWV0ZXJCeU5hbWUgPSAobmFtZSwgdXJsKSA9PiB7XG4gIGlmICghdXJsKVxuICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApLFxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG4gIGlmICghcmVzdWx0cylcbiAgICByZXR1cm4gbnVsbDtcbiAgaWYgKCFyZXN1bHRzWzJdKVxuICAgIHJldHVybiAnJztcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcbn1cblxuLyoqXG4gKiBFeHBhbmQgYWRkIHJldmlldyAgXG4gKi9cbmNvbnN0IGFkZFJldmlld0J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtcmV2aWV3Jyk7XG5hZGRSZXZpZXdCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1Ym1pdC1yZXZpZXcnKTtcbiAgZm9ybS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgYWRkUmV2aWV3QnV0dG9uLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsIHRydWUpO1xufSk7XG5cbi8qKlxuICogUG9zdCByZXZpZXdcbiAqL1xuY29uc3QgcG9zdFJldmlld0J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3N0LXJldmlldycpO1xucG9zdFJldmlld0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIFxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25hbWUnKTtcbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29tbWVudHMnKTtcbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JhdGluZycpO1xuXG4gIC8vIFZhbGlkYXRlIHJldmlldyBmaWVsZHNcbiAgaWYgKG5hbWUudmFsdWUgPT09ICcnIHx8IGNvbW1lbnRzLnZhbHVlID09PSAnJyB8fCByYXRpbmcudmFsdWUgPT09ICcnKSByZXR1cm47XG5cbiAgY29uc3QgcmV2aWV3ID0ge31cbiAgcmV2aWV3Lm5hbWUgPSBuYW1lLnZhbHVlO1xuICByZXZpZXcucmF0aW5nID0gcmF0aW5nLnZhbHVlO1xuICByZXZpZXcuY29tbWVudHMgPSBjb21tZW50cy52YWx1ZTtcbiAgcmV2aWV3LmRhdGUgPSBtb21lbnQoKS5mb3JtYXQoJ01NTU0gRCwgWVlZWScpO1xuICByZXZpZXcuc3luY2VkID0gZmFsc2U7XG5cbiAgLy8gUmVzZXQgdmFsdWVzXG4gIG5hbWUudmFsdWUgPSAnJztcbiAgY29tbWVudHMudmFsdWUgPSAnJztcbiAgcmF0aW5nLnZhbHVlID0gLTE7XG5cbiAgLy8gRmV0Y2ggcmVzdGF1cmFudCBmcm9tIERCXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoc2VsZi5yZXN0YXVyYW50LmlkLCAoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcbiAgICBpZiAocmVzdGF1cmFudCkge1xuICAgICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcblxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc2VsZi5yZXN0YXVyYW50LnJldmlld3MpKSB7XG4gICAgICAgIHNlbGYucmVzdGF1cmFudC5yZXZpZXdzLnB1c2gocmV2aWV3KTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBzZWxmLnJlc3RhdXJhbnQucmV2aWV3cyA9IFtdO1xuICAgICAgICBzZWxmLnJlc3RhdXJhbnQucmV2aWV3cy5wdXNoKHJldmlldyk7XG4gICAgICB9XG5cbiAgICAgIERCSGVscGVyLnVwZGF0ZVJlc3RhdXJhbnRSZXZpZXdzKHNlbGYucmVzdGF1cmFudCkudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWJtaXQtcmV2aWV3Jyk7XG4gICAgICAgICAgZm9ybS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXG4gICAgICAgICAgYWRkUmV2aWV3QnV0dG9uLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsIGZhbHNlKTtcblxuICAgICAgICAgIGNvbnN0IHRvYXN0ID0gVG9hc3QuY3JlYXRlKHtcbiAgICAgICAgICAgIHRleHQ6IFwiUmV2aWV3IHN1Ym1pdHRlZC5cIlxuICAgICAgICAgIH0pO1xuICAgICAgICAgIFRvYXN0LnNldFRpbWVvdXQodG9hc3QuaWQsIDIwMDApO1xuXG4gICAgICAgICAgZmlsbFJldmlld3NIVE1MKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59KTtcblxuLyoqXG4gKiBIYW5kbGUgZmF2b3JpdGUgYnV0dG9uXG4gKi9cbmNvbnN0IGZhdkJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmYXZidXR0b24nKTtcbmZhdmJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIGlmIChmYXZidXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCdoZWFydC1hY3RpdmUnKSkge1xuICAgIHNlbGYucmVzdGF1cmFudC5pc19mYXZvcml0ZSA9IGZhbHNlO1xuICAgIGZhdmJ1dHRvbi5jbGFzc05hbWUgPSAnaGVhcnQtaW5hY3RpdmUnO1xuICAgIERCSGVscGVyLmZhdm9yaXRlUmVzdGF1cmFudChzZWxmLnJlc3RhdXJhbnQpO1xuICB9XG4gIGVsc2Uge1xuICAgIHNlbGYucmVzdGF1cmFudC5pc19mYXZvcml0ZSA9IHRydWU7XG4gICAgZmF2YnV0dG9uLmNsYXNzTmFtZSA9ICdoZWFydC1hY3RpdmUnO1xuICAgIERCSGVscGVyLmZhdm9yaXRlUmVzdGF1cmFudChzZWxmLnJlc3RhdXJhbnQpO1xuICB9XG59KVxuXG4vKipcbiAqIE9mZmxpbmUgZXZlbnQgaGFuZGxlclxuICovXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb2ZmbGluZScsICgpID0+IHtcbiAgY29uc3QgdG9hc3QgPSBUb2FzdC5jcmVhdGUoe1xuICAgIHRleHQ6IFwiVW5hYmxlIHRvIGNvbm5lY3QuIFJldHJ5aW5nLi4uXCJcbiAgfSk7XG5cbiAgVG9hc3Quc2V0VGltZW91dCh0b2FzdC5pZCwgNTAwMCk7XG59KTtcblxuLyoqXG4gKiBPbmxpbmUgZXZlbnQgaGFuZGxlclxuICovXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb25saW5lJywgKCkgPT4ge1xuICB3b3JrZXIucG9zdE1lc3NhZ2Uoe1xuICAgIGNtZDogJ3N5bmNfcmV2aWV3cydcbiAgfSk7XG59KSJdLCJmaWxlIjoicmVzdGF1cmFudF9pbmZvLmpzIn0=
