class DBHelper{static fetchRestaurants(t){openDatabase().then(e=>{let n=e.transaction("restaurants").objectStore("restaurants");n.getAll().then(o=>{0==o.length?fetch("http://localhost:1337/restaurants").then(t=>t.json()).then(o=>{o&&(n=e.transaction("restaurants","readwrite").objectStore("restaurants"),o.forEach(t=>{n.put(t,t.id)}),t(null,o))}).catch(e=>{t(e,null)}):t(null,o)})})}static fetchRestaurantById(t,e){openDatabase().then(n=>{let o=n.transaction("restaurants").objectStore("restaurants");o.get(t).then(r=>{r?e(null,r):fetch(`http://localhost:1337/restaurants/${t}`).then(t=>t.json()).then(r=>{r&&((o=n.transaction("restaurants","readwrite").objectStore("restaurants")).put(r,t),e(null,r))}).catch(t=>{e(t,"Restaurant does not exist")})})})}static fetchRestaurantByCuisine(t,e){DBHelper.fetchRestaurants((n,o)=>{if(n)e(n,null);else{const n=o.filter(e=>e.cuisine_type==t);e(null,n)}})}static fetchRestaurantByNeighborhood(t,e){DBHelper.fetchRestaurants((n,o)=>{if(n)e(n,null);else{const n=o.filter(e=>e.neighborhood==t);e(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,n){DBHelper.fetchRestaurants((o,r)=>{if(o)n(o,null);else{let o=r;"all"!=t&&(o=o.filter(e=>e.cuisine_type==t)),"all"!=e&&(o=o.filter(t=>t.neighborhood==e)),n(null,o)}})}static fetchNeighborhoods(t){DBHelper.fetchRestaurants((e,n)=>{if(e)t(e,null);else{const e=n.map((t,e)=>n[e].neighborhood),o=e.filter((t,n)=>e.indexOf(t)==n);t(null,o)}})}static fetchCuisines(t){DBHelper.fetchRestaurants((e,n)=>{if(e)t(e,null);else{const e=n.map((t,e)=>n[e].cuisine_type),o=e.filter((t,n)=>e.indexOf(t)==n);t(null,o)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return`/img/${DBHelper.imageNameForRestaurant(t)}-small.jpg`}static imageNameForRestaurant(t){return t.photograph?t.photograph:"default"}static mapMarkerForRestaurant(t,e){const n=new L.marker([t.latlng.lat,t.latlng.lng],{title:t.name,alt:t.name,url:DBHelper.urlForRestaurant(t)});return n.addTo(newMap),n}}function openDatabase(){return navigator.serviceWorker?idb.open("mws-restaurants",1,t=>t.createObjectStore("restaurants")):Promise.resolve()}DBHelper.imageUrlBasePath="/img/",function(){function t(t){return new Promise(function(e,n){t.onsuccess=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function e(e,n,o){var r,a=new Promise(function(a,i){t(r=e[n].apply(e,o)).then(a,i)});return a.request=r,a}function n(t,e,n){n.forEach(function(n){Object.defineProperty(t.prototype,n,{get:function(){return this[e][n]},set:function(t){this[e][n]=t}})})}function o(t,n,o,r){r.forEach(function(r){r in o.prototype&&(t.prototype[r]=function(){return e(this[n],r,arguments)})})}function r(t,e,n,o){o.forEach(function(o){o in n.prototype&&(t.prototype[o]=function(){return this[e][o].apply(this[e],arguments)})})}function a(t,n,o,r){r.forEach(function(r){r in o.prototype&&(t.prototype[r]=function(){return t=this[n],(o=e(t,r,arguments)).then(function(t){if(t)return new s(t,o.request)});var t,o})})}function i(t){this._index=t}function s(t,e){this._cursor=t,this._request=e}function c(t){this._store=t}function u(t){this._tx=t,this.complete=new Promise(function(e,n){t.oncomplete=function(){e()},t.onerror=function(){n(t.error)},t.onabort=function(){n(t.error)}})}function l(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new u(n)}function d(t){this._db=t}n(i,"_index",["name","keyPath","multiEntry","unique"]),o(i,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),a(i,"_index",IDBIndex,["openCursor","openKeyCursor"]),n(s,"_cursor",["direction","key","primaryKey","value"]),o(s,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(s.prototype[e]=function(){var n=this,o=arguments;return Promise.resolve().then(function(){return n._cursor[e].apply(n._cursor,o),t(n._request).then(function(t){if(t)return new s(t,n._request)})})})}),c.prototype.createIndex=function(){return new i(this._store.createIndex.apply(this._store,arguments))},c.prototype.index=function(){return new i(this._store.index.apply(this._store,arguments))},n(c,"_store",["name","keyPath","indexNames","autoIncrement"]),o(c,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),a(c,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),r(c,"_store",IDBObjectStore,["deleteIndex"]),u.prototype.objectStore=function(){return new c(this._tx.objectStore.apply(this._tx,arguments))},n(u,"_tx",["objectStoreNames","mode"]),r(u,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new c(this._db.createObjectStore.apply(this._db,arguments))},n(l,"_db",["name","version","objectStoreNames"]),r(l,"_db",IDBDatabase,["deleteObjectStore","close"]),d.prototype.transaction=function(){return new u(this._db.transaction.apply(this._db,arguments))},n(d,"_db",["name","version","objectStoreNames"]),r(d,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(t){[c,i].forEach(function(e){t in e.prototype&&(e.prototype[t.replace("open","iterate")]=function(){var e,n=(e=arguments,Array.prototype.slice.call(e)),o=n[n.length-1],r=this._store||this._index,a=r[t].apply(r,n.slice(0,-1));a.onsuccess=function(){o(a.result)}})})}),[i,c].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var n=this,o=[];return new Promise(function(r){n.iterateCursor(t,function(t){t?(o.push(t.value),void 0===e||o.length!=e?t.continue():r(o)):r(o)})})})});var p={open:function(t,n,o){var r=e(indexedDB,"open",[t,n]),a=r.request;return a&&(a.onupgradeneeded=function(t){o&&o(new l(a.result,t.oldVersion,a.transaction))}),r.then(function(t){return new d(t)})},delete:function(t){return e(indexedDB,"deleteDatabase",[t])}};"undefined"!=typeof module?(module.exports=p,module.exports.default=module.exports):self.idb=p}(),registerServiceWorker=(()=>{if(!navigator.serviceWorker)return;let t;navigator.serviceWorker.register("/sw.js").then(t=>{navigator.serviceWorker.controller&&(t.waiting?updateReady(t.waiting):t.installing?trackInstalling(t.installing):t.addEventListener("updatefound",()=>trackInstalling(t.installing)))}),navigator.serviceWorker.addEventListener("controllerchange",()=>{t||(window.location.reload(),t=!0)})}),updateReady=(t=>{Toast.create({text:"New version available.",button:"Refresh",callback:e=>{e.preventDefault(),t.postMessage({action:"skipWaiting"})}})}),trackInstalling=(t=>{t.addEventListener("statechange",()=>{"installed"===t.state&&updateReady(t)})}),function(t,e){try{"object"==typeof exports?module.exports=e():t.Toast=e()}catch(t){console.log("Isomorphic compatibility is not supported at this time for Toast.")}}(this,function(){"complete"===document.readyState?e():window.addEventListener("DOMContentLoaded",e),Toast={create:function(){console.error(["DOM has not finished loading.","\tInvoke create method when DOMs readyState is complete"].join("\n"))},setTimeout:function(){console.error(["DOM has not finished loading.","\tInvoke create method when DOMs readyState is complete"].join("\n"))},toasts:{}};var t=0;function e(){var e=document.createElement("div");e.id="toast-container",document.body.appendChild(e),Toast.create=function(e){var n=document.createElement("div");if(n.id=++t,n.id="toast-"+n.id,n.className="toast",e.title){var o=document.createElement("h4");o.className="toast-title",o.innerHTML=e.title,n.appendChild(o)}if(e.text){var r=document.createElement("p");r.className="toast-text",r.innerHTML=e.text,n.appendChild(r)}if(e.icon){var a=document.createElement("img");a.src=e.icon,a.className="toast-icon",n.appendChild(a)}if(e.button){var i=document.createElement("button");i.className="toast-button",i.innerHTML=e.button,n.appendChild(i)}function s(){document.getElementById("toast-container").removeChild(n),delete Toast.toasts[n.id]}return"function"==typeof e.callback&&n.addEventListener("click",e.callback),n.hide=function(){n.className+=" toast-fadeout",n.addEventListener("animationend",s,!1)},e.timeout&&setTimeout(n.hide,e.timeout),e.type&&(n.className+=" toast-"+e.type),n.addEventListener("click",n.hide),document.getElementById("toast-container").appendChild(n),Toast.toasts[n.id]=n,n},Toast.setTimeout=function(t,e){Toast.toasts[t]&&setTimeout(Toast.toasts[t].hide,e)}}return Toast});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwiaWRiLmpzIiwic2VydmljZS13b3JrZXIuanMiLCJ0b2FzdC5qcyJdLCJuYW1lcyI6WyJEQkhlbHBlciIsIltvYmplY3QgT2JqZWN0XSIsImNhbGxiYWNrIiwib3BlbkRhdGFiYXNlIiwidGhlbiIsImRiIiwic3RvcmUiLCJ0cmFuc2FjdGlvbiIsIm9iamVjdFN0b3JlIiwiZ2V0QWxsIiwicmVzdGF1cmFudHMiLCJsZW5ndGgiLCJmZXRjaCIsInJlc3BvbnNlIiwianNvbiIsImZvckVhY2giLCJyZXN0YXVyYW50IiwicHV0IiwiY2F0Y2giLCJlcnJvciIsImlkIiwiZ2V0IiwiY3Vpc2luZSIsImZldGNoUmVzdGF1cmFudHMiLCJyZXN1bHRzIiwiZmlsdGVyIiwiciIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZCIsIm5laWdoYm9yaG9vZHMiLCJtYXAiLCJ2IiwiaSIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwiY3Vpc2luZXMiLCJ1bmlxdWVDdWlzaW5lcyIsImltYWdlTmFtZUZvclJlc3RhdXJhbnQiLCJwaG90b2dyYXBoIiwibWFya2VyIiwiTCIsImxhdGxuZyIsImxhdCIsImxuZyIsInRpdGxlIiwibmFtZSIsImFsdCIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhZGRUbyIsIm5ld01hcCIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJpZGIiLCJvcGVuIiwidXBncmFkZURCIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJQcm9taXNlIiwicmVzb2x2ZSIsImltYWdlVXJsQmFzZVBhdGgiLCJwcm9taXNpZnlSZXF1ZXN0IiwicmVxdWVzdCIsInJlamVjdCIsIm9uc3VjY2VzcyIsInJlc3VsdCIsIm9uZXJyb3IiLCJwcm9taXNpZnlSZXF1ZXN0Q2FsbCIsIm9iaiIsIm1ldGhvZCIsImFyZ3MiLCJwIiwiYXBwbHkiLCJwcm94eVByb3BlcnRpZXMiLCJQcm94eUNsYXNzIiwidGFyZ2V0UHJvcCIsInByb3BlcnRpZXMiLCJwcm9wIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJwcm90b3R5cGUiLCJ0aGlzIiwic2V0IiwidmFsIiwicHJveHlSZXF1ZXN0TWV0aG9kcyIsIkNvbnN0cnVjdG9yIiwiYXJndW1lbnRzIiwicHJveHlNZXRob2RzIiwicHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyIsInZhbHVlIiwiQ3Vyc29yIiwiSW5kZXgiLCJpbmRleCIsIl9pbmRleCIsImN1cnNvciIsIl9jdXJzb3IiLCJfcmVxdWVzdCIsIk9iamVjdFN0b3JlIiwiX3N0b3JlIiwiVHJhbnNhY3Rpb24iLCJpZGJUcmFuc2FjdGlvbiIsIl90eCIsImNvbXBsZXRlIiwib25jb21wbGV0ZSIsIm9uYWJvcnQiLCJVcGdyYWRlREIiLCJvbGRWZXJzaW9uIiwiX2RiIiwiREIiLCJJREJJbmRleCIsIklEQkN1cnNvciIsIm1ldGhvZE5hbWUiLCJjcmVhdGVJbmRleCIsIklEQk9iamVjdFN0b3JlIiwiSURCVHJhbnNhY3Rpb24iLCJJREJEYXRhYmFzZSIsImZ1bmNOYW1lIiwicmVwbGFjZSIsImFyciIsIkFycmF5Iiwic2xpY2UiLCJjYWxsIiwibmF0aXZlT2JqZWN0IiwicXVlcnkiLCJjb3VudCIsImluc3RhbmNlIiwiaXRlbXMiLCJpdGVyYXRlQ3Vyc29yIiwicHVzaCIsInVuZGVmaW5lZCIsImNvbnRpbnVlIiwiZXhwIiwidmVyc2lvbiIsInVwZ3JhZGVDYWxsYmFjayIsImluZGV4ZWREQiIsIm9udXBncmFkZW5lZWRlZCIsImV2ZW50IiwiZGVsZXRlIiwibW9kdWxlIiwiZXhwb3J0cyIsImRlZmF1bHQiLCJzZWxmIiwicmVnaXN0ZXJTZXJ2aWNlV29ya2VyIiwicmVmcmVzaGluZyIsInJlZ2lzdGVyIiwicmVnIiwiY29udHJvbGxlciIsIndhaXRpbmciLCJ1cGRhdGVSZWFkeSIsImluc3RhbGxpbmciLCJ0cmFja0luc3RhbGxpbmciLCJhZGRFdmVudExpc3RlbmVyIiwid2luZG93IiwibG9jYXRpb24iLCJyZWxvYWQiLCJ3b3JrZXIiLCJUb2FzdCIsImNyZWF0ZSIsInRleHQiLCJidXR0b24iLCJwcmV2ZW50RGVmYXVsdCIsInBvc3RNZXNzYWdlIiwiYWN0aW9uIiwic3RhdGUiLCJyb290IiwiZmFjdG9yeSIsImNvbnNvbGUiLCJsb2ciLCJkb2N1bWVudCIsInJlYWR5U3RhdGUiLCJpbml0Iiwiam9pbiIsInNldFRpbWVvdXQiLCJ0b2FzdHMiLCJhdXRvaW5jcmVtZW50IiwiY29udGFpbmVyIiwiY3JlYXRlRWxlbWVudCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsIm9wdGlvbnMiLCJ0b2FzdCIsImNsYXNzTmFtZSIsImg0IiwiaW5uZXJIVE1MIiwiaWNvbiIsImltZyIsInNyYyIsInJlbW92ZVRvYXN0IiwiZ2V0RWxlbWVudEJ5SWQiLCJyZW1vdmVDaGlsZCIsImhpZGUiLCJ0aW1lb3V0IiwidHlwZSIsInRvYXN0aWQiXSwibWFwcGluZ3MiOiJBQUdBLE1BQU1BLFNBS0pDLHdCQUF3QkMsR0FDdEJDLGVBQWVDLEtBQUtDLElBQ2xCLElBQUlDLEVBQVFELEVBQUdFLFlBQVksZUFBZUMsWUFBWSxlQUN0REYsRUFBTUcsU0FBU0wsS0FBS00sSUFDUSxHQUF0QkEsRUFBWUMsT0FDZEMsTUFBTSxxQ0FDTFIsS0FBS1MsR0FBWUEsRUFBU0MsUUFDMUJWLEtBQUtNLElBQ0FBLElBQ0ZKLEVBQVFELEVBQUdFLFlBQVksY0FBZSxhQUFhQyxZQUFZLGVBQy9ERSxFQUFZSyxRQUFRQyxJQUNsQlYsRUFBTVcsSUFBSUQsRUFBWUEsRUFBVSxNQUVsQ2QsRUFBUyxLQUFNUSxNQUdsQlEsTUFBTUMsSUFDTGpCLEVBQVNpQixFQUFPLFFBSWxCakIsRUFBUyxLQUFNUSxPQVN2QlQsMkJBQTJCbUIsRUFBSWxCLEdBRTdCQyxlQUFlQyxLQUFLQyxJQUNsQixJQUFJQyxFQUFRRCxFQUFHRSxZQUFZLGVBQWVDLFlBQVksZUFDdERGLEVBQU1lLElBQUlELEdBQUloQixLQUFLWSxJQUNaQSxFQWVIZCxFQUFTLEtBQU1jLEdBZGZKLDJDQUEyQ1EsS0FDMUNoQixL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QUFZVCxVQUNoRHhCLE1BQU1pQixPQUFPTyxFQUFNL0osSUFRNUIsTUFoQ2dDLG1CQUFyQjhKLEVBQVFoTCxVQUNqQmlMLEVBQU03QixpQkFBaUIsUUFBUzRCLEVBQVFoTCxVQUkxQ2lMLEVBQU1VLEtBQU8sV0FDWFYsRUFBTUMsV0FBYSxpQkFDbkJELEVBQU03QixpQkFBaUIsZUFBZ0JvQyxHQUFhLElBSWxEUixFQUFRWSxTQUNWbkIsV0FBV1EsRUFBTVUsS0FBTVgsRUFBUVksU0FHN0JaLEVBQVFhLE9BQ1ZaLEVBQU1DLFdBQWEsVUFBWUYsRUFBUWEsTUFHekNaLEVBQU03QixpQkFBaUIsUUFBUzZCLEVBQU1VLE1BUXRDdEIsU0FBU29CLGVBQWUsbUJBQW1CVixZQUFZRSxHQUd2RHhCLE1BQU1pQixPQUFPTyxFQUFNL0osSUFBTStKLEVBRWxCQSxHQVNUeEIsTUFBTWdCLFdBQWEsU0FBU3FCLEVBQVM5RyxHQUNoQ3lFLE1BQU1pQixPQUFPb0IsSUFDZHJCLFdBQVdoQixNQUFNaUIsT0FBT29CLEdBQVNILEtBQU0zRyxJQUs3QyxPQUFPeUUiLCJmaWxlIjoibGlicy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcbmNsYXNzIERCSGVscGVyIHtcclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcbiAgICBvcGVuRGF0YWJhc2UoKS50aGVuKGRiID0+IHtcclxuICAgICAgbGV0IHN0b3JlID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJykub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XHJcbiAgICAgIHN0b3JlLmdldEFsbCgpLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICAgIGlmIChyZXN0YXVyYW50cy5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgZmV0Y2goXCJodHRwOi8vbG9jYWxob3N0OjEzMzcvcmVzdGF1cmFudHNcIilcclxuICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcclxuICAgICAgICAgIC50aGVuKHJlc3RhdXJhbnRzID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlc3RhdXJhbnRzKSB7XHJcbiAgICAgICAgICAgICAgc3RvcmUgPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJykub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XHJcbiAgICAgICAgICAgICAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLnB1dChyZXN0YXVyYW50LCByZXN0YXVyYW50WydpZCddKVxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgIG9wZW5EYXRhYmFzZSgpLnRoZW4oZGIgPT4ge1xyXG4gICAgICBsZXQgc3RvcmUgPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnKS5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKTtcclxuICAgICAgc3RvcmUuZ2V0KGlkKS50aGVuKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgICAgIGlmICghcmVzdGF1cmFudCkge1xyXG4gICAgICAgICAgZmV0Y2goYGh0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXN0YXVyYW50cy8ke2lkfWApXHJcbiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXHJcbiAgICAgICAgICAudGhlbihyZXN0YXVyYW50ID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHtcclxuICAgICAgICAgICAgICBzdG9yZSA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkd3JpdGUnKS5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKTtcclxuICAgICAgICAgICAgICBzdG9yZS5wdXQocmVzdGF1cmFudCwgaWQpO1xyXG4gICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIFwiUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdFwiKVxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50c1xyXG4gICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKVxyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcigodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGkpXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAvaW1nLyR7REJIZWxwZXIuaW1hZ2VOYW1lRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX0tc21hbGwuanBnYCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIG5hbWUuXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlTmFtZUZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgaWYgKHJlc3RhdXJhbnQucGhvdG9ncmFwaClcclxuICAgICAgcmV0dXJuIHJlc3RhdXJhbnQucGhvdG9ncmFwaDtcclxuICAgIHJldHVybiAnZGVmYXVsdCc7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gICBzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcclxuICAgIC8vIGh0dHBzOi8vbGVhZmxldGpzLmNvbS9yZWZlcmVuY2UtMS4zLjAuaHRtbCNtYXJrZXIgIFxyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IEwubWFya2VyKFtyZXN0YXVyYW50LmxhdGxuZy5sYXQsIHJlc3RhdXJhbnQubGF0bG5nLmxuZ10sXHJcbiAgICAgIHt0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICBhbHQ6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpXHJcbiAgICAgIH0pXHJcbiAgICAgIG1hcmtlci5hZGRUbyhuZXdNYXApO1xyXG4gICAgcmV0dXJuIG1hcmtlcjtcclxuICB9IFxyXG4gIC8qIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcclxuICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxyXG4gICAgICBtYXA6IG1hcCxcclxuICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUH1cclxuICAgICk7XHJcbiAgICByZXR1cm4gbWFya2VyO1xyXG4gIH0gKi9cclxuXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBSZXN0YXVyYW50IGltYWdlIGJhc2UgcGF0aC5cclxuICovXHJcbkRCSGVscGVyLmltYWdlVXJsQmFzZVBhdGggPSAnL2ltZy8nO1xyXG5cclxuLyoqXHJcbiAqIFJldHVybiBJbmRleGVkREJcclxuICovXHJcbmZ1bmN0aW9uIG9wZW5EYXRhYmFzZSgpIHtcclxuICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgcmV0dXJuIGlkYi5vcGVuKCdtd3MtcmVzdGF1cmFudHMnLCAxLCB1cGdyYWRlREIgPT4gdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpKTtcclxufVxyXG5cclxuIiwiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIHRvQXJyYXkoYXJyKSB7XG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycik7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzdWx0KTtcbiAgICAgIH07XG5cbiAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcmVxdWVzdDtcbiAgICB2YXIgcCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdCA9IG9ialttZXRob2RdLmFwcGx5KG9iaiwgYXJncyk7XG4gICAgICBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICB9KTtcblxuICAgIHAucmVxdWVzdCA9IHJlcXVlc3Q7XG4gICAgcmV0dXJuIHA7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpO1xuICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBwLnJlcXVlc3QpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlQcm9wZXJ0aWVzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFByb3h5Q2xhc3MucHJvdG90eXBlLCBwcm9wLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF07XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgdGhpc1t0YXJnZXRQcm9wXVtwcm9wXSA9IHZhbDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0uYXBwbHkodGhpc1t0YXJnZXRQcm9wXSwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gSW5kZXgoaW5kZXgpIHtcbiAgICB0aGlzLl9pbmRleCA9IGluZGV4O1xuICB9XG5cbiAgcHJveHlQcm9wZXJ0aWVzKEluZGV4LCAnX2luZGV4JywgW1xuICAgICduYW1lJyxcbiAgICAna2V5UGF0aCcsXG4gICAgJ211bHRpRW50cnknLFxuICAgICd1bmlxdWUnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuICAgICdnZXQnLFxuICAgICdnZXRLZXknLFxuICAgICdnZXRBbGwnLFxuICAgICdnZXRBbGxLZXlzJyxcbiAgICAnY291bnQnXG4gIF0pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuICAgICdvcGVuQ3Vyc29yJyxcbiAgICAnb3BlbktleUN1cnNvcidcbiAgXSk7XG5cbiAgZnVuY3Rpb24gQ3Vyc29yKGN1cnNvciwgcmVxdWVzdCkge1xuICAgIHRoaXMuX2N1cnNvciA9IGN1cnNvcjtcbiAgICB0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhDdXJzb3IsICdfY3Vyc29yJywgW1xuICAgICdkaXJlY3Rpb24nLFxuICAgICdrZXknLFxuICAgICdwcmltYXJ5S2V5JyxcbiAgICAndmFsdWUnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoQ3Vyc29yLCAnX2N1cnNvcicsIElEQkN1cnNvciwgW1xuICAgICd1cGRhdGUnLFxuICAgICdkZWxldGUnXG4gIF0pO1xuXG4gIC8vIHByb3h5ICduZXh0JyBtZXRob2RzXG4gIFsnYWR2YW5jZScsICdjb250aW51ZScsICdjb250aW51ZVByaW1hcnlLZXknXS5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZE5hbWUpIHtcbiAgICBpZiAoIShtZXRob2ROYW1lIGluIElEQkN1cnNvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgQ3Vyc29yLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGN1cnNvciA9IHRoaXM7XG4gICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICBjdXJzb3IuX2N1cnNvclttZXRob2ROYW1lXS5hcHBseShjdXJzb3IuX2N1cnNvciwgYXJncyk7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KGN1cnNvci5fcmVxdWVzdCkudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgY3Vyc29yLl9yZXF1ZXN0KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICBmdW5jdGlvbiBPYmplY3RTdG9yZShzdG9yZSkge1xuICAgIHRoaXMuX3N0b3JlID0gc3RvcmU7XG4gIH1cblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuY3JlYXRlSW5kZXggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmNyZWF0ZUluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuaW5kZXggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBbXG4gICAgJ25hbWUnLFxuICAgICdrZXlQYXRoJyxcbiAgICAnaW5kZXhOYW1lcycsXG4gICAgJ2F1dG9JbmNyZW1lbnQnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdwdXQnLFxuICAgICdhZGQnLFxuICAgICdkZWxldGUnLFxuICAgICdjbGVhcicsXG4gICAgJ2dldCcsXG4gICAgJ2dldEFsbCcsXG4gICAgJ2dldEtleScsXG4gICAgJ2dldEFsbEtleXMnLFxuICAgICdjb3VudCdcbiAgXSk7XG5cbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ29wZW5DdXJzb3InLFxuICAgICdvcGVuS2V5Q3Vyc29yJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdkZWxldGVJbmRleCdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gVHJhbnNhY3Rpb24oaWRiVHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl90eCA9IGlkYlRyYW5zYWN0aW9uO1xuICAgIHRoaXMuY29tcGxldGUgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmFib3J0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgVHJhbnNhY3Rpb24ucHJvdG90eXBlLm9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl90eC5vYmplY3RTdG9yZS5hcHBseSh0aGlzLl90eCwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFRyYW5zYWN0aW9uLCAnX3R4JywgW1xuICAgICdvYmplY3RTdG9yZU5hbWVzJyxcbiAgICAnbW9kZSdcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKFRyYW5zYWN0aW9uLCAnX3R4JywgSURCVHJhbnNhY3Rpb24sIFtcbiAgICAnYWJvcnQnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIFVwZ3JhZGVEQihkYiwgb2xkVmVyc2lvbiwgdHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICAgIHRoaXMub2xkVmVyc2lvbiA9IG9sZFZlcnNpb247XG4gICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XG4gIH1cblxuICBVcGdyYWRlREIucHJvdG90eXBlLmNyZWF0ZU9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl9kYi5jcmVhdGVPYmplY3RTdG9yZS5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFVwZ3JhZGVEQiwgJ19kYicsIFtcbiAgICAnbmFtZScsXG4gICAgJ3ZlcnNpb24nLFxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoVXBncmFkZURCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcbiAgICAnZGVsZXRlT2JqZWN0U3RvcmUnLFxuICAgICdjbG9zZSdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gREIoZGIpIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICB9XG5cbiAgREIucHJvdG90eXBlLnRyYW5zYWN0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBUcmFuc2FjdGlvbih0aGlzLl9kYi50cmFuc2FjdGlvbi5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKERCLCAnX2RiJywgW1xuICAgICduYW1lJyxcbiAgICAndmVyc2lvbicsXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG4gICAgJ2Nsb3NlJ1xuICBdKTtcblxuICAvLyBBZGQgY3Vyc29yIGl0ZXJhdG9yc1xuICAvLyBUT0RPOiByZW1vdmUgdGhpcyBvbmNlIGJyb3dzZXJzIGRvIHRoZSByaWdodCB0aGluZyB3aXRoIHByb21pc2VzXG4gIFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10uZm9yRWFjaChmdW5jdGlvbihmdW5jTmFtZSkge1xuICAgIFtPYmplY3RTdG9yZSwgSW5kZXhdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcbiAgICAgIC8vIERvbid0IGNyZWF0ZSBpdGVyYXRlS2V5Q3Vyc29yIGlmIG9wZW5LZXlDdXJzb3IgZG9lc24ndCBleGlzdC5cbiAgICAgIGlmICghKGZ1bmNOYW1lIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcblxuICAgICAgQ29uc3RydWN0b3IucHJvdG90eXBlW2Z1bmNOYW1lLnJlcGxhY2UoJ29wZW4nLCAnaXRlcmF0ZScpXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzKTtcbiAgICAgICAgdmFyIGNhbGxiYWNrID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdO1xuICAgICAgICB2YXIgbmF0aXZlT2JqZWN0ID0gdGhpcy5fc3RvcmUgfHwgdGhpcy5faW5kZXg7XG4gICAgICAgIHZhciByZXF1ZXN0ID0gbmF0aXZlT2JqZWN0W2Z1bmNOYW1lXS5hcHBseShuYXRpdmVPYmplY3QsIGFyZ3Muc2xpY2UoMCwgLTEpKTtcbiAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjYWxsYmFjayhyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICAgIH07XG4gICAgICB9O1xuICAgIH0pO1xuICB9KTtcblxuICAvLyBwb2x5ZmlsbCBnZXRBbGxcbiAgW0luZGV4LCBPYmplY3RTdG9yZV0uZm9yRWFjaChmdW5jdGlvbihDb25zdHJ1Y3Rvcikge1xuICAgIGlmIChDb25zdHJ1Y3Rvci5wcm90b3R5cGUuZ2V0QWxsKSByZXR1cm47XG4gICAgQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCA9IGZ1bmN0aW9uKHF1ZXJ5LCBjb3VudCkge1xuICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcbiAgICAgIHZhciBpdGVtcyA9IFtdO1xuXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkge1xuICAgICAgICBpbnN0YW5jZS5pdGVyYXRlQ3Vyc29yKHF1ZXJ5LCBmdW5jdGlvbihjdXJzb3IpIHtcbiAgICAgICAgICBpZiAoIWN1cnNvcikge1xuICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGl0ZW1zLnB1c2goY3Vyc29yLnZhbHVlKTtcblxuICAgICAgICAgIGlmIChjb3VudCAhPT0gdW5kZWZpbmVkICYmIGl0ZW1zLmxlbmd0aCA9PSBjb3VudCkge1xuICAgICAgICAgICAgcmVzb2x2ZShpdGVtcyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGN1cnNvci5jb250aW51ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0pO1xuXG4gIHZhciBleHAgPSB7XG4gICAgb3BlbjogZnVuY3Rpb24obmFtZSwgdmVyc2lvbiwgdXBncmFkZUNhbGxiYWNrKSB7XG4gICAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ29wZW4nLCBbbmFtZSwgdmVyc2lvbl0pO1xuICAgICAgdmFyIHJlcXVlc3QgPSBwLnJlcXVlc3Q7XG5cbiAgICAgIGlmIChyZXF1ZXN0KSB7XG4gICAgICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICBpZiAodXBncmFkZUNhbGxiYWNrKSB7XG4gICAgICAgICAgICB1cGdyYWRlQ2FsbGJhY2sobmV3IFVwZ3JhZGVEQihyZXF1ZXN0LnJlc3VsdCwgZXZlbnQub2xkVmVyc2lvbiwgcmVxdWVzdC50cmFuc2FjdGlvbikpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHAudGhlbihmdW5jdGlvbihkYikge1xuICAgICAgICByZXR1cm4gbmV3IERCKGRiKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsZXRlOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdENhbGwoaW5kZXhlZERCLCAnZGVsZXRlRGF0YWJhc2UnLCBbbmFtZV0pO1xuICAgIH1cbiAgfTtcblxuICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGV4cDtcbiAgICBtb2R1bGUuZXhwb3J0cy5kZWZhdWx0ID0gbW9kdWxlLmV4cG9ydHM7XG4gIH1cbiAgZWxzZSB7XG4gICAgc2VsZi5pZGIgPSBleHA7XG4gIH1cbn0oKSk7IiwiLyoqXG4gKiBSZWdpc3RlciBzZXJ2aWNlIHdvcmtlclxuICovXG5cbnJlZ2lzdGVyU2VydmljZVdvcmtlciA9ICgpID0+IHtcbiAgICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSByZXR1cm47XG5cbiAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignL3N3LmpzJykudGhlbihyZWcgPT4ge1xuICAgICAgaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5jb250cm9sbGVyKSByZXR1cm47XG5cbiAgICAgIGlmIChyZWcud2FpdGluZykge1xuICAgICAgICB1cGRhdGVSZWFkeShyZWcud2FpdGluZyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKHJlZy5pbnN0YWxsaW5nKSB7XG4gICAgICAgIHRyYWNrSW5zdGFsbGluZyhyZWcuaW5zdGFsbGluZyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgcmVnLmFkZEV2ZW50TGlzdGVuZXIoJ3VwZGF0ZWZvdW5kJywgKCkgPT4gdHJhY2tJbnN0YWxsaW5nKHJlZy5pbnN0YWxsaW5nKSk7XG4gICAgfSk7XG5cbiAgICBsZXQgcmVmcmVzaGluZztcbiAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5hZGRFdmVudExpc3RlbmVyKCdjb250cm9sbGVyY2hhbmdlJywgKCkgPT4ge1xuICAgICAgaWYocmVmcmVzaGluZykgcmV0dXJuO1xuICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgcmVmcmVzaGluZyA9IHRydWU7XG4gICAgfSlcbn1cblxudXBkYXRlUmVhZHkgPSAod29ya2VyKSA9PiB7XG4gIGNvbnN0IHRvYXN0ID0gVG9hc3QuY3JlYXRlKHtcbiAgICB0ZXh0OiBcIk5ldyB2ZXJzaW9uIGF2YWlsYWJsZS5cIixcbiAgICBidXR0b246IFwiUmVmcmVzaFwiLFxuICAgIGNhbGxiYWNrOiBldmVudCA9PiB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHthY3Rpb246ICdza2lwV2FpdGluZyd9KTtcbiAgICB9XG4gIH0pO1xufVxuXG50cmFja0luc3RhbGxpbmcgPSAod29ya2VyKSA9PiB7XG4gICAgd29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ3N0YXRlY2hhbmdlJywgKCkgPT4ge1xuICAgICAgaWYgKHdvcmtlci5zdGF0ZSA9PT0gJ2luc3RhbGxlZCcpIHtcbiAgICAgICAgdXBkYXRlUmVhZHkod29ya2VyKTtcbiAgICAgIH1cbiAgICB9KTtcbn0iLCIvKipcbiAqIEBhdXRob3IgaHR0cHM6Ly9naXRodWIuY29tL0FsZXhLdmF6b3MvVmFuaWxsYVRvYXN0cy9ibG9iL21hc3Rlci92YW5pbGxhdG9hc3RzLmpzXG4gKi9cblxuXG4oZnVuY3Rpb24ocm9vdCwgZmFjdG9yeSkge1xuICB0cnkge1xuICAgIC8vIGNvbW1vbmpzXG4gICAgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG4gICAgLy8gZ2xvYmFsXG4gICAgfSBlbHNlIHtcbiAgICAgIHJvb3QuVG9hc3QgPSBmYWN0b3J5KCk7XG4gICAgfVxuICB9IGNhdGNoKGVycm9yKSB7XG4gICAgY29uc29sZS5sb2coJ0lzb21vcnBoaWMgY29tcGF0aWJpbGl0eSBpcyBub3Qgc3VwcG9ydGVkIGF0IHRoaXMgdGltZSBmb3IgVG9hc3QuJylcbiAgfVxufSkodGhpcywgZnVuY3Rpb24oKSB7XG5cbiAgLy8gV2UgbmVlZCBET00gdG8gYmUgcmVhZHlcbiAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpIHtcbiAgICBpbml0KCk7XG4gIH0gZWxzZSB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBpbml0KTtcbiAgfVxuXG4gIC8vIENyZWF0ZSBUb2FzdCBvYmplY3RcbiAgVG9hc3QgPSB7XG4gICAgLy8gSW4gY2FzZSB0b2FzdCBjcmVhdGlvbiBpcyBhdHRlbXB0ZWQgYmVmb3JlIGRvbSBoYXMgZmluaXNoZWQgbG9hZGluZyFcbiAgICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgY29uc29sZS5lcnJvcihbXG4gICAgICAgICdET00gaGFzIG5vdCBmaW5pc2hlZCBsb2FkaW5nLicsXG4gICAgICAgICdcXHRJbnZva2UgY3JlYXRlIG1ldGhvZCB3aGVuIERPTVxccyByZWFkeVN0YXRlIGlzIGNvbXBsZXRlJ1xuICAgICAgXS5qb2luKCdcXG4nKSlcbiAgICB9LFxuICAgIC8vZnVuY3Rpb24gdG8gbWFudWFsbHkgc2V0IHRpbWVvdXQgYWZ0ZXIgY3JlYXRlXG4gICAgc2V0VGltZW91dDogZnVuY3Rpb24oKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFtcbiAgICAgICAgJ0RPTSBoYXMgbm90IGZpbmlzaGVkIGxvYWRpbmcuJyxcbiAgICAgICAgJ1xcdEludm9rZSBjcmVhdGUgbWV0aG9kIHdoZW4gRE9NXFxzIHJlYWR5U3RhdGUgaXMgY29tcGxldGUnXG4gICAgICBdLmpvaW4oJ1xcbicpKVxuICAgIH0sXG4gICAgdG9hc3RzOiB7fSAvL3N0b3JlIHRvYXN0cyB0byBtb2RpZnkgbGF0ZXJcbiAgfTtcbiAgdmFyIGF1dG9pbmNyZW1lbnQgPSAwO1xuXG4gIC8vIEluaXRpYWxpemUgbGlicmFyeVxuICBmdW5jdGlvbiBpbml0KCkge1xuICAgIC8vIFRvYXN0IGNvbnRhaW5lclxuICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjb250YWluZXIuaWQgPSAndG9hc3QtY29udGFpbmVyJztcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNvbnRhaW5lcik7XG5cbiAgICAvLyBAT3ZlcnJpZGVcbiAgICAvLyBSZXBsYWNlIGNyZWF0ZSBtZXRob2Qgd2hlbiBET00gaGFzIGZpbmlzaGVkIGxvYWRpbmdcbiAgICBUb2FzdC5jcmVhdGUgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICB2YXIgdG9hc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIHRvYXN0LmlkID0gKythdXRvaW5jcmVtZW50O1xuICAgICAgdG9hc3QuaWQgPSAndG9hc3QtJyArIHRvYXN0LmlkO1xuICAgICAgdG9hc3QuY2xhc3NOYW1lID0gJ3RvYXN0JztcblxuICAgICAgLy8gdGl0bGVcbiAgICAgIGlmIChvcHRpb25zLnRpdGxlKSB7XG4gICAgICAgIHZhciBoNCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2g0Jyk7XG4gICAgICAgIGg0LmNsYXNzTmFtZSA9ICd0b2FzdC10aXRsZSc7XG4gICAgICAgIGg0LmlubmVySFRNTCA9IG9wdGlvbnMudGl0bGU7XG4gICAgICAgIHRvYXN0LmFwcGVuZENoaWxkKGg0KTtcbiAgICAgIH1cblxuICAgICAgLy8gdGV4dFxuICAgICAgaWYgKG9wdGlvbnMudGV4dCkge1xuICAgICAgICB2YXIgcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICAgICAgcC5jbGFzc05hbWUgPSAndG9hc3QtdGV4dCc7XG4gICAgICAgIHAuaW5uZXJIVE1MID0gb3B0aW9ucy50ZXh0O1xuICAgICAgICB0b2FzdC5hcHBlbmRDaGlsZChwKTtcbiAgICAgIH1cblxuICAgICAgLy8gaWNvblxuICAgICAgaWYgKG9wdGlvbnMuaWNvbikge1xuICAgICAgICB2YXIgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgICAgIGltZy5zcmMgPSBvcHRpb25zLmljb247XG4gICAgICAgIGltZy5jbGFzc05hbWUgPSAndG9hc3QtaWNvbic7XG4gICAgICAgIHRvYXN0LmFwcGVuZENoaWxkKGltZyk7XG4gICAgICB9XG5cbiAgICAgIC8vIGJ1dHRvblxuICAgICAgaWYgKG9wdGlvbnMuYnV0dG9uKSB7XG4gICAgICAgIHZhciBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgICAgICAgYnV0dG9uLmNsYXNzTmFtZSA9ICd0b2FzdC1idXR0b24nO1xuICAgICAgICBidXR0b24uaW5uZXJIVE1MID0gb3B0aW9ucy5idXR0b247XG4gICAgICAgIHRvYXN0LmFwcGVuZENoaWxkKGJ1dHRvbik7XG4gICAgICB9XG5cbiAgICAgIC8vIGNsaWNrIGNhbGxiYWNrXG4gICAgICBpZiAodHlwZW9mIG9wdGlvbnMuY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgdG9hc3QuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvcHRpb25zLmNhbGxiYWNrKTtcbiAgICAgIH1cblxuICAgICAgLy8gdG9hc3QgYXBpXG4gICAgICB0b2FzdC5oaWRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHRvYXN0LmNsYXNzTmFtZSArPSAnIHRvYXN0LWZhZGVvdXQnO1xuICAgICAgICB0b2FzdC5hZGRFdmVudExpc3RlbmVyKCdhbmltYXRpb25lbmQnLCByZW1vdmVUb2FzdCwgZmFsc2UpO1xuICAgICAgfTtcblxuICAgICAgLy8gYXV0b2hpZGVcbiAgICAgIGlmIChvcHRpb25zLnRpbWVvdXQpIHtcbiAgICAgICAgc2V0VGltZW91dCh0b2FzdC5oaWRlLCBvcHRpb25zLnRpbWVvdXQpO1xuICAgICAgfVxuXG4gICAgICBpZiAob3B0aW9ucy50eXBlKSB7XG4gICAgICAgIHRvYXN0LmNsYXNzTmFtZSArPSAnIHRvYXN0LScgKyBvcHRpb25zLnR5cGU7XG4gICAgICB9XG5cbiAgICAgIHRvYXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdG9hc3QuaGlkZSk7XG5cblxuICAgICAgZnVuY3Rpb24gcmVtb3ZlVG9hc3QoKSB7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2FzdC1jb250YWluZXInKS5yZW1vdmVDaGlsZCh0b2FzdCk7XG4gICAgICAgIGRlbGV0ZSBUb2FzdC50b2FzdHNbdG9hc3QuaWRdOyAgLy9yZW1vdmUgdG9hc3QgZnJvbSBvYmplY3RcbiAgICAgIH1cblxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvYXN0LWNvbnRhaW5lcicpLmFwcGVuZENoaWxkKHRvYXN0KTtcblxuICAgICAgLy9hZGQgdG9hc3QgdG8gb2JqZWN0IHNvIGl0cyBlYXNpbHkgZ2V0dGFibGUgYnkgaXRzIGlkXG4gICAgICBUb2FzdC50b2FzdHNbdG9hc3QuaWRdID0gdG9hc3Q7XG5cbiAgICAgIHJldHVybiB0b2FzdDtcbiAgICB9XG5cbiAgICAvKlxuICAgIGN1c3RvbSBmdW5jdGlvbiB0byBtYW51YWxseSBpbml0aWF0ZSB0aW1lb3V0IG9mXG4gICAgdGhlIHRvYXN0LiAgVXNlZnVsIGlmIHRvYXN0IGlzIGNyZWF0ZWQgYXMgcGVyc2lzdGFudFxuICAgIGJlY2F1c2Ugd2UgZG9uJ3Qgd2FudCBpdCB0byBzdGFydCB0byB0aW1lb3V0IHVudGlsXG4gICAgd2UgdGVsbCBpdCB0b1xuICAgICovXG4gICAgVG9hc3Quc2V0VGltZW91dCA9IGZ1bmN0aW9uKHRvYXN0aWQsIHZhbCkge1xuICAgICAgaWYoVG9hc3QudG9hc3RzW3RvYXN0aWRdKXtcbiAgICAgICAgc2V0VGltZW91dChUb2FzdC50b2FzdHNbdG9hc3RpZF0uaGlkZSwgdmFsKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gVG9hc3Q7XG5cbn0pOyJdfQ==
